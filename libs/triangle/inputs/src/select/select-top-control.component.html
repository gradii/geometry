<ng-template #inputTemplate>
  <input #inputElement
    autocomplete="something-new"
    class="tri-select-search__field"
    (compositionstart)="isComposing = true"
    (compositionend)="isComposing = false"
    (input)="updateWidth()"
    [ngModel]="inputValue"
    (ngModelChange)="setInputValue($event)"
    [disabled]="selectService.disabled">
</ng-template>
<div class="tri-select-selection__rendered">
  <div *ngIf="placeHolder"
    tri-select-unselectable
    [style.display]="placeHolderDisplay"
    class="tri-select-selection__placeholder">{{ placeHolder }}</div>
  <!--single mode-->
  <ng-container *ngIf="selectService.isSingleMode">
    <!--selected label-->
    <div *ngIf="selectService.listOfCachedSelectedOption.length && selectService.listOfSelectedValue.length"
      class="tri-select-selection-selected-value"
      [attr.title]="selectService.listOfCachedSelectedOption[0]?.label"
      [ngStyle]="selectedValueStyle">
      {{ selectService.listOfCachedSelectedOption[0]?.label }}
    </div>
    <!--show search-->
    <div *ngIf="showSearch"
      class="tri-select-search tri-select-search--inline">
      <div class="tri-select-search__field__wrap">
        <ng-template [ngTemplateOutlet]="inputTemplate"></ng-template>
        <span class="tri-select-search__field__mirror">{{inputValue}}&nbsp;</span>
      </div>
    </div>
  </ng-container>
  <!--multiple or tags mode-->
  <ul *ngIf="selectService.isMultipleOrTags">
    <ng-container *ngFor="let option of selectService.listOfCachedSelectedOption | slice: 0 : maxTagCount;trackBy:trackValue;">
      <li [@zoomAnimation]
          [attr.title]="option.label"
          [class.tri-select-selection__choice__disabled]="option.disabled"
          class="tri-select-selection__choice">
        <div class="tri-select-selection__choice__content">{{ option.label }}</div>
        <span *ngIf="!option.disabled"
          class="tri-select-selection__choice__remove"
          (mousedown)="$event.preventDefault()"
          (click)="removeSelectedValue(option, $event)">
          <i nz-icon type="close" class="tri-select-remove-icon" *ngIf="!removeIcon; else removeIcon"></i>
        </span>
      </li>
    </ng-container>
    <li *ngIf="selectService.listOfCachedSelectedOption.length > maxTagCount"
        [@zoomAnimation]
        class="tri-select-selection__choice">
      <div class="tri-select-selection__choice__content">
        <ng-container *ngIf="maxTagPlaceholder">
          <ng-template
            [ngTemplateOutlet]="maxTagPlaceholder"
            [ngTemplateOutletContext]="{ $implicit: selectService.listOfSelectedValue | slice: maxTagCount}">
          </ng-template>
        </ng-container>
        <ng-container *ngIf="!maxTagPlaceholder">
          + {{ selectService.listOfCachedSelectedOption.length - maxTagCount }} ...
        </ng-container>
      </div>
    </li>
    <li class="tri-select-search tri-select-search--inline">
      <ng-template [ngTemplateOutlet]="inputTemplate"></ng-template>
    </li>
  </ul>
</div>
<span *ngIf="allowClear && selectService.listOfSelectedValue.length"
  class="tri-select-selection__clear"
  tri-select-unselectable
  (mousedown)="$event.preventDefault()"
  (click)="onClearSelection($event)">
    <i nz-icon type="close-circle" theme="fill" *ngIf="!clearIcon; else clearIcon" class="tri-select-close-icon"></i>
  </span>
<span class="tri-select-arrow" tri-select-unselectable *ngIf="showArrow">
  <i nz-icon type="loading" *ngIf="loading; else defaultArrow"></i>
  <ng-template #defaultArrow>
    <i nz-icon type="down" class="tri-select-arrow-icon" *ngIf="!suffixIcon; else suffixIcon"></i>
  </ng-template>
</span>
